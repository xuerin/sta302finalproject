---
title: "preliminary_model"
author: "Erin Xu & Dora Dong"
date: "2025-05-19"
output: html_document
---

```{r message=FALSE, echo=FALSE, warning=FALSE, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
packages <- c("tidyverse", "latex2exp", "gridExtra", "rvest", "kableExtra", "leaps")
lapply(packages, require, character.only = T)
set.seed(420)
```

# Load data and check if needed to clean. 
```{r, echo=FALSE}
all_data <- read.csv("life_expectancy.csv", na.strings = c("", "NA"))
anyNA(all_data)
sum(is.na(all_data))
colSums(is.na(all_data))
```

# Check for regression assumptions. 
```{r, echo=FALSE}
```

# Decide predictors 
```{r echo=FALSE}

all_data <- read.csv("life_expectancy.csv")
all_data <- na.omit(all_data)

all_data$Status <- as.factor(all_data$Status)


# Clean model
full_model <- lm(GDP ~ Life.expectancy + Status + Adult.Mortality + infant.deaths + Alcohol +
                   percentage.expenditure + Hepatitis.B + Measles + BMI + under.five.deaths + Polio +
                   Total.expenditure + Diphtheria + HIV.AIDS + Population +
                   thinness..1.19.years + thinness.5.9.years +
                   Income.composition.of.resources + Schooling,
                 data = all_data)
summary(full_model)

step_model <- step(full_model, direction = "both")
summary(step_model)
```

# Best subset selection
```{r echo=FALSE}
best_model <- regsubsets(Life.expectancy ~ GDP + Status + Adult.Mortality + infant.deaths + Alcohol +
                           percentage.expenditure + Hepatitis.B + Measles + BMI + under.five.deaths + Polio +
                           Total.expenditure + Diphtheria + HIV.AIDS + Population +
                           thinness..1.19.years + thinness.5.9.years +
                           Income.composition.of.resources + Schooling,
                         data = all_data, nvmax = 10)

# Summary and plot
best_summary <- summary(best_model)
plot(best_model, scale = "adjr2")
```

# Get the response and predictors. 
```{r echo=FALSE}
all_data <- read.csv("life_expectancy.csv")
all_data <- na.omit(all_data)
response <- all_data$GDP
x0 <- all_data$percentage.expenditure
x1 <- all_data$Polio
x2 <- all_data$Population
x3 <- all_data$Income.composition.of.resources
x4 <- all_data$Schooling

all_data$Status <- as.factor(all_data$Status)

model <- lm(response ~ Status + x0 + x1 + x2 + x3 + x4, data = all_data)
summary(model)
```

# Residual plots
```{r message=FALSE, echo=FALSE, warning=FALSE}
par(mfrow = c(2, 2))
plot(model)
```

# Residual VS each predictor

```{r,message=FALSE, echo=FALSE,warning=FALSE}

library(ggplot2)


all_data$residuals <- resid(model)
all_data$fitted <- fitted(model)

p1 <- ggplot(all_data, aes(x = `percentage.expenditure`, y = residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  labs(title = "Residuals vs Percentage Expenditure")

p2 <- ggplot(all_data, aes(x = Polio, y = residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  labs(title = "Residuals vs Polio")

p3 <- ggplot(all_data, aes(x = Population, y = residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  labs(title = "Residuals vs Population")

p4 <- ggplot(all_data, aes(x = `Income.composition.of.resources`, y = residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  labs(title = "Residuals vs Income Composition")

p5 <- ggplot(all_data, aes(x = Schooling, y = residuals)) +
  geom_point(alpha = 0.6) +
  geom_hline(yintercept = 0, color = "red", linetype = "dashed") +
  labs(title = "Residuals vs Schooling")

p6 <- ggplot(all_data, aes(x = as.factor(Status), y = residuals)) +
  geom_boxplot(fill = "lightgray") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  scale_x_discrete(labels = c("Developing", "Developed")) +
  labs(title = "Residuals vs Status",
       x = "Status",
       y = "Residuals")

p1
p2
p3
p4
p5
p6
```

