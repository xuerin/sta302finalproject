---
title:  "Modeling GDP Using Health and Socioeconomic Indicators"
author: "Erin Xu, Dora Dong, Shencen Cai, Sharon Lam"
date: "2025-06-12"
output: 
  pdf_document:
    extra_dependencies: ["bbm"]
urlcolor: blue
bibliography: references.bib
nocite: '@*'
link-citations: true
---
# Introduction
Gross domestic product (GDP) is a widely used measure of a country’s economic output, representing the total market value of goods and services produced within its borders over a specified period. It serves as a key indicator of national economic performance and enables comparison across countries and time periods. From economic theory, GDP is influenced by components such as consumer spending, government expenditures, investment in capital goods, and net exports. Factors like human capital, infrastructure, technological innovation, and political stability are also vital.

This project applies multiple linear regression (MLR) to investigate the extent to which health-related and socioeconomic factors are associated with GDP, with the research question being: *To what extent do government spending on health and socioeconomic resources affect a country’s GDP?* Specifically, country status (developed vs. developing), percentage expenditure on health, polio immunization coverage, income composition of resources, years of schooling, and population are the combination of continuous and categorical predictors used to explain the extent in which they affect GDP in countries around the world. Health spending, represented by percent of a country's expenditure and polio immunization coverage, has been shown to enhance productivity, and income composition and national development status reflect broader socioeconomic conditions. Education and population are also recognized as structural drivers of economic growth because educated workers increases human capital, research and innovation for better products, processes and overall economic advancement. 

As economic theory suggests a positive relationship between GDP and improved development indicators, and estimating a linear model allows us to quantify the individual contribution of each predictor to GDP while controlling for the others, a positive relationship between GDP and indicated predictors can be expected. The focus of this analysis is on interpretability, to understand how each predictor relates to economic output and to support evidence-based approaches to development and policy planning.  

# Data description
The dataset used in this project is titled *Life Expectancy* (WHO), sourced from *Kaggle* (Kumar, 2018). Its primary usage is for health data analysis. Data collectors combined publicly available data from the *World Health Organization* (WHO) and the *United Nations* (UN), which were gathered through national health departments, structured questionnaires, and annual statistical submissions by participating countries (World Health Organization, n.d.; United Nations, n.d.). The sample comprises over 1,600 complete observations, focusing on education, demographic, and socioeconomic indicators relevant to economic growth.  

While the dataset was initially intended to examine factors affecting life expectancy, this project selects 7 of the original 22 variables that align with economic theory, which emphasizes the importance of education, health, and human capital in supporting sustained increases in GDP.  

The preliminary model is prone to multiple violations of model assumption, but multiple linear regression is still an appropriate method for analysis, as the scatterplots of the response and each predictor show a huge potential for linear association, constant error variance, and uncorrelated and normal errors, through diagnostic procedures like predictor transformations. 

\
Table 1: Variables used in the model

| **Variable**                    | **Description**                                                                 | **Type**              |
|--------------------------------|---------------------------------------------------------------------------------|------------------------|
| GDP                            | Gross Domestic Product per capita (USD)                                        | Response variable      |
| Status                         | Developed or Developing status                                                 | Categorical variable   |
| Percentage expenditure         | Expenditure on health as a percentage of Gross Domestic Product per capita (%) | Continuous variable       |
| Polio                          | Polio immunization coverage among 1-year-olds (%)                              | Continuous variable       |
| Population                     | Population of the country                                                      | Continuous variable       |
| Income composition of resources| Human Development Index in terms of income composition (index from 0 to 1)     | Continuous variable       |
| Schooling                      | Number of years of schooling (years)                                           | Continuous variable       |


Table 2: Continuous variables summary

| Variable                         |   Mean   |   Std   |   Min   |   Q1   | Median |   Q3   |   Max    |
|----------------------------------|----------|---------|---------|--------|--------|--------|----------|
| GDP                              | 7483.16  | 14270.17| 1.68    | 463.94 |1766.95| 5910.81| 119172.74|
| Percentage expenditure           | 738.25   | 1987.91 | 0.01    | 4.69   | 64.91  |441.53  |19479.91  |
| Polio                            | 82.55    | 23.43   | 3.00    | 78.00  | 93.00  | 97.00  |99.00   |
| Population                       | 1.28e+07 | 6.10e+07| 34.00   | 1.96e+05|1.39e+06|7.42e+06|1.29e+09  |
| Income composition of resources  | 0.63     | 0.21    | 0.00    | 0.49   | 0.68   | 0.78   | 0.95     |
| Schooling                        | 11.99    | 3.36    | 0.00    | 10.10   | 12.30  | 14.30  | 20.70    |

Table 3: Status (categorical variable) frequency

| Status     | Frequency |
|------------|-----------|
| Developing | 2426      |
| Developed  | 512       |
| **Total**  | 2938      |


Figure 1: Scatter plots of GDP against numeric predictors  
```{r message=FALSE, echo=FALSE, warning=FALSE, include=FALSE}
packages <- c("tidyverse", "latex2exp", "gridExtra", "rvest", 
              "kableExtra", "leaps", "ggplot2", "patchwork")
lapply(packages, require, character.only = T)
set.seed(420)
all_data <- read.csv("life_expectancy.csv")
```

```{r fig.width = 10, fig.length=12, echo=FALSE, message=FALSE, warning=FALSE}
# the matrix
scatter_plot <- function(xvar, xlab) {
  ggplot(all_data, aes_string(x = xvar, y = "GDP")) +
    geom_point(color = "black", alpha = 0.6) +
    geom_smooth(method = "lm", se = FALSE, color = "blue") +
    labs(
      title = paste("GDP vs", xlab),
      x = xlab,
      y = "GDP"
    ) +
    theme_minimal()
}

# Create plots
p1 <- scatter_plot("percentage.expenditure", "Health ercentage expenditure")
p2 <- scatter_plot("Polio", "Polio")
p3 <- scatter_plot("Population", "Population")
p4 <- scatter_plot("Income.composition.of.resources", "Income composition of resources")
p5 <- scatter_plot("Schooling", "Schooling")

# Combine in layout
(p1 | p2 | p3) / (p4 | p5)
```
GDP increases as health percentage expenditure does in a rather compelling linear manner, although the clustering near the lower ends of the domain is concerning due to outliers in countries that are experiencing geopolitical turmoil. GDP and polio as well as income composition of resources and schooling demonstrate weaker positive trends, looking more quadratic, most likely with leverage points at the tails. It's clear that there are bad leverage points in GDP and population. In the context of geography and the complexity of individual states, one can suspend their disbelief easily about certain leverage points, but nonetheless, these need to be dealt with to provide a more accurate prediction of GDP with the set predictors at hand. 

Figure 2: Histogram of GDP & numeric predictors  
\
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Create a common theme with smaller text and better use of space
compact_theme <- theme(
  plot.title = element_text(size = 9, face = "bold"),
  axis.title = element_text(size = 8),
  axis.text = element_text(size = 7),
  plot.margin = margin(3, 3, 3, 3, "pt")
)

# Create the six histograms with the compact theme
p1 <- ggplot(all_data, aes(x = GDP)) +
  geom_histogram(binwidth = 1000, fill = "skyblue", color = "white") +
  labs(title = "Distribution of GDP", x = "GDP", y = "Frequency") +
  scale_x_continuous(
    limits = c(0, 50000),          # Set axis range from 0 to 50,000
    breaks = seq(0, 50000, 10000), # Set tick marks at intervals of 10,000
    labels = scales::comma          # Format numbers with commas
  ) +
  compact_theme

p2 <- ggplot(all_data, aes(x = percentage.expenditure)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "white") +
  labs(title = "Distribution of % Expenditure", x = "% Expenditure", y = "Frequency") +
  scale_x_continuous(
    limits = c(0, 100),        # Reduced axis range from 0 to 100
    breaks = seq(0, 100, 20),  # Set tick marks at intervals of 20
    labels = scales::comma      # Format numbers with commas
  ) +
  scale_y_continuous(
    limits = c(0, 100),        # Y-axis range from 0 to 100
    breaks = seq(0, 100, 20)   # Y-axis tick marks at intervals of 20
  ) +
  compact_theme

p3 <- ggplot(all_data, aes(x = Polio)) +
  geom_histogram(binwidth = 2, fill = "skyblue", color = "white") +
  labs(title = "Distribution of Polio", x = "Polio", y = "Frequency") +
  compact_theme

p4 <- ggplot(all_data, aes(x = Population)) +
  geom_histogram(binwidth = 10000000, fill = "skyblue", color = "white") +
  labs(title = "Distribution of Population", x = "Population (billions)", y = "Frequency") +
  scale_x_continuous(
    limits = c(0, 1.2e9),                   # X-axis range from 0 to 1.2 billion
    breaks = seq(0, 1.2e9, 0.2e9),          # X-axis tick marks at intervals of 0.2 billion
    labels = function(x) x/1e9              # Format as billions (0, 0.2, 0.4, etc.)
  ) +
  scale_y_continuous(
    limits = c(0, 500),                    # Y-axis range from 0 to 2500
    breaks = seq(0, 500, 100)              # Y-axis tick marks at intervals of 500
  ) +
  compact_theme

p5 <- ggplot(all_data, aes(x = Income.composition.of.resources)) +
  geom_histogram(binwidth = 0.02, fill = "skyblue", color = "white") +
  labs(title = "Distribution of Income Composition", x = "Income Composition", y = "Frequency") +
  compact_theme

p6 <- ggplot(all_data, aes(x = Schooling)) +
  geom_histogram(binwidth = 0.5, fill = "skyblue", color = "white") +
  labs(title = "Distribution of Schooling", x = "Schooling", y = "Frequency") +
  compact_theme

# Use patchwork to arrange plots with custom layout
library(patchwork)
combined_plot <- (p1 | p2 | p3) / (p4 | p5 | p6)

# Apply global theme adjustments to the combined plot
combined_plot & 
  theme(plot.margin = margin(1, 1, 1, 1, "pt")) &
  plot_layout(guides = "collect")
```
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Boilerplate common theme again
compact_theme <- theme(
  plot.title = element_text(size = 9, face = "bold"),
  axis.title = element_text(size = 8),
  axis.text = element_text(size = 7),
  plot.margin = margin(3, 3, 3, 3, "pt")
)
# boxplot
ggplot(all_data, aes(x = Status, y = GDP)) +
  geom_boxplot(fill = "skyblue") +
  labs(title = "GDP per Capita by Country Status",
       x = "Status",
       y = "GDP per Capita") + coord_cartesian(ylim = c(0, 1e+05))

```
GDP, percentage expenditure, and population are strongly right-skewed, with mostly low values. Schooling and income composition are slightly left-skewed, clustering at the high end. Income composition is also bimodal, although there is potential for a bell-curve-like shape. Polio rates are highly left-skewed. Since country status is a categorical predictor, the boxplot graph is better suited to evaluating the normality assumption. Developed countries have a higher median GDP per capital and wider IQR range, which indicates greater variability than developing countries, which violates a model assumption. Also, developing countries appear highly skewed to the right, with most countries clustered at low GDP per capital values. The long tail of outliers stretching upward indicate a few developing countries with relatively high GDPs. In context, these outlier countries like Malaysia, Mexico, or Turkey are often classified more deeply as upper-middle-income economies (World Bank) because they clearly act as outliers compared to the rest of the developing world. 

# Primary model results and diagnostics
Initially, the distribution of GDP was heavily right-skewed due to a small number of countries with disproportionately large economies. Residual plots also showed signs of heteroscedasticity, violating regression assumptions. To address this, we applied a log transformation to the response variable, which preserved the interpretability of a linear model while improving the spread of residuals.

The adjusted R-squared of the transformed model was 0.9258, indicating that 92.6% of the variation in GDP is explained by the model. Among numerical predictors, percentage expenditure on health and schooling were both statistically significant (p < 0.001), suggesting strong positive relationships with GDP. This supports the idea that education and health investment enhance human capital and economic productivity (Radcliffe, Raghupathi). For the categorical predictor Status (Developed vs. Developing), the p-value was approximately 0.0038, indicating that developed countries tend to have significantly higher GDPs after accounting for other variables. In contrast, polio immunization and population size were not statistically significant, implying weaker associations.  

The residual plots assess linearity and constant variance assumptions. Residuals were mostly centered around zero, but a slight V-shape indicates some remaining heteroscedasticity, especially at the lower and higher ends of fitted GDP. This suggests more stable residuals in middle-income countries, while richer and poorer countries show more unpredictable patterns. For example, the U.S., Qatar, and Luxembourg all have high GDPs, but for very different reasons (tech, gas, or tax policy). Similarly, lower-income countries may have inconsistent or less reliable data.  

The Q-Q plot showed that residuals were somewhat normal, but skewed left. Residuals versus individual predictors showed random scatter for income composition and schooling, but some structure for expenditure, population, and polio, suggesting potential nonlinearities.  

Overall, the model shows evidence that educational and economic factors influence GDP, though remaining issues with heteroscedasticity and non-normal residuals should be better resolved, as these violations weaken ordinary least squares (OLS) model accuracy. Employing further transformations like Box-Cox, investigating covariance, colinearity, the removal of bad leverage points and outliers, comparison of different models through F-test and analysis of variance (ANOVA), or even exploring weighted least squares (WLS) are key stratagem to confidently predict the expected GDP in a country. 

# Model seleection

# Final model inference and results 

# Discussion and conclusion `

# Author contributions

# References 


```{r message=FALSE, echo=FALSE, warning=FALSE, include=FALSE}
packages <- c("tidyverse", "latex2exp", "gridExtra", "rvest", 
              "kableExtra", "leaps", "ggplot2", "patchwork", "car", "MASS")
lapply(packages, require, character.only = T)
set.seed(320)
all_data <- read.csv("life_expectancy.csv")
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
all_data <- read.csv("life_expectancy.csv")
all_data <- na.omit(all_data)
all_data$Status <- as.factor(all_data$Status)

hist(all_data$Population)
hist(all_data$Schooling)
hist(all_data$Polio)
hist(all_data$Total.expenditure)
hist(all_data$Income.composition.of.resources)

# Cleaned full model
#### This is the original model #######
full_model <- lm(GDP ~ Life.expectancy + Status + Adult.Mortality + 
                   infant.deaths + Alcohol + Total.expenditure + percentage.expenditure+
                   Hepatitis.B + Measles + BMI + under.five.deaths + Polio
                   + Diphtheria + HIV.AIDS + Population +
                   thinness..1.19.years + thinness.5.9.years +
                   Income.composition.of.resources + Schooling,
                 data = all_data)
summary(full_model)

step_model <- step(full_model, direction = "both")
summary(step_model)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}

all_data <- read.csv("life_expectancy.csv")
all_data <- na.omit(all_data)
all_data$Status <- as.factor(all_data$Status)

### model1 result of stepwise ####

model1 <- lm(GDP ~ Status + Total.expenditure + Polio+ percentage.expenditure + Income.composition.of.resources
                  + Schooling , data = all_data)
summary(model1)

par(mfrow = c(2, 2))
plot(model1)

## model2 replace percentage expenditure with population for meaningful interpretation of model coefficients

model2 <- lm(GDP ~ Status + Total.expenditure + Polio + Population + Income.composition.of.resources
                  + Schooling , data = all_data)
summary(model2)

par(mfrow = c(2, 2))
plot(model2)

## Model 3 Box_Cox tansformed response variable y

bc <- boxcox(model2, plotit = TRUE)
(lambda_optimal <- bc$x[which.max(bc$y)])

all_data$bc_GDP <- (all_data$GDP^0.1010101 - 1)/0.1010101
all_data$Status <- as.factor(all_data$Status)

model3 <- lm(bc_GDP ~ Status + Total.expenditure + Polio + Population 
             + Income.composition.of.resources  + Schooling, data = all_data)
summary(model3)

par(mfrow = c(2, 2))
plot(model3)


# Model 4 Only squared Polio and Income

model4 <- lm(GDP ~ Status + Total.expenditure
                          + I(Polio^2) + Population + I(Income.composition.of.resources^2)
                              + Schooling, data = all_data)
summary(model4)

par(mfrow = c(2, 2))
plot(model4)


# Model 5 Combination of box-cox and squared

model5 <- lm(bc_GDP ~ Status + Total.expenditure + I(Polio^2)
             + I(Population^2)
             + Income.composition.of.resources
             + Schooling,
             data = all_data)
summary(model5)

par(mfrow = c(2, 2))
plot(model5)


# Model 6 (Final Model)
# the best model when combine box-cox and squared

model6 <- lm(bc_GDP ~ Status +I(Total.expenditure^2) +Polio
             + I(log(Population))
             + Income.composition.of.resources
             + I(Schooling^2),
             data = all_data)

summary(model6)

par(mfrow = c(2, 2))
plot(model6)

#check multicolinearity
vif(model6)

#check AIC & BIC for all model we have

aic_results <- AIC(model1, model2, model3, model4, model5, model6)
bic_results <- BIC(model1, model2, model3, model4, model5, model6)
print(aic_results)
print(bic_results)


# some plots
mod.resid <- resid(model6)
mod.fitted <- fitted(model6)
mod.sresid <- rstandard(model6)

## Response vs. Fitted plot
plot(mod.fitted,all_data$bc_GDP,xlab="Fitted",ylab="GDP",
     main="Fitted vs Response")
abline(a=0,b=1,col="red",lwd=2)

## Residuals vs Fitted plot
plot(mod.fitted,mod.resid,xlab="Fitted",ylab="Residuals",
     main="Fitted vs. Residuals")
abline(h=0,col="blue",lwd=2)

## QQ plot
qqnorm(mod.sresid); qqline(mod.sresid)

## check leverage point/ influential point/ outliers

## Leverage points
mod.hii <- hatvalues(model6)
plot(mod.hii,type="h",ylab='hii',main="Leverage values")
## Define the cutoff for leverage points
cutoff.leveragepoints <- 2*(6+1)/nrow(all_data)
cutoff.leveragepoints.bis <- 3*(6+1)/nrow(all_data)
abline(h=cutoff.leveragepoints,col="red")
abline(h=cutoff.leveragepoints.bis,col="blue")
abline(h=0.5,col="green")
mod.hii
which(mod.hii>cutoff.leveragepoints)

## Outliers
plot(mod.sresid,type="h")
abline(h=4,col="red")
abline(h=-4,col="red")
which(abs(mod.sresid)>4)

## Influential points

## 1. Cook's distance
mod.dii <- cooks.distance(model6)
plot(mod.dii,type="h",ylab="Dii")
cutoff_dii <- qf(0.5,df1=7,df2=(nrow(all_data)-6-1))
abline(h=cutoff_dii,col="red")
abline(h=1,col="blue")
abline(h=4/nrow(all_data),col="green")
which(mod.dii>(4/nrow(all_data)))
## Based on the cutoff 4/n

## 2. Difference in fitted values
mod.dffits <- dffits(model6)
plot(mod.dffits,type="h",ylab="DFFITS")
cutoff.dffits <- 2*sqrt(7/nrow(all_data))
abline(h=cutoff.dffits,col="red")
abline(h=-cutoff.dffits,col="red")
which(abs(mod.dffits)>cutoff.dffits)

## remove outliers

remove_invalid <- unique(c(
  which(abs(mod.sresid)>4)
))

clean_data6 <- all_data[-remove_invalid, ]

# clean model

clean_model6 <- lm(bc_GDP ~ Status 
             +I(Total.expenditure^2)
             + Polio
             + I(log(Population))
             + Income.composition.of.resources
             + I(Schooling^2),
             data = clean_data6)
summary(clean_model6)

par(mfrow = c(2, 2))
plot(clean_model6)
