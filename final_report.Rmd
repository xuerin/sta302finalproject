---
title:  "Modeling GDP Using Health and Socioeconomic Indicators"
author: "Erin Xu, Dora Dong, Shencen Cai, Sharon Lam"
date: "2025-06-12"
output: 
  pdf_document:
    extra_dependencies: ["bbm"]
urlcolor: blue
bibliography: references.bib
nocite: '@*'
link-citations: true
---

### original model ###
```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(MASS)

all_data <- read.csv("Life_Expectancy_Data.csv")
all_data <- na.omit(all_data)

response <- all_data$GDP
x0 <- all_data$percentage.expenditure
x1 <- all_data$Polio
x2 <- all_data$Population
x3 <- all_data$Income.composition.of.resources
x4 <- all_data$Schooling
all_data$Status <- as.factor(all_data$Status)

model0 <- lm(response ~ Status + x0 + x1 + x2 + x3 + x4, data = all_data)
summary(model0)

par(mfrow = c(2, 2))
plot(model0)

#### box-cox (Î»=0.3) 
bc <- boxcox(model0, plotit = TRUE)
(lambda_optimal <- bc$x[which.max(bc$y)])
``` 

### model 1 box-cox transformation ###

```{r, echo=FALSE, message=FALSE, warning=FALSE}
all_data <- read.csv("Life_Expectancy_Data.csv")
all_data <- na.omit(all_data)

all_data$GDP_bc <- (all_data$GDP^0.3030303 - 1)/0.3030303
response <- all_data$GDP_bc
all_data$Status <- as.factor(all_data$Status)

model1 <- lm(response ~ Status + all_data$percentage.expenditure + all_data$Polio + all_data$Population + all_data$Income.composition.of.resources  
                              + all_data$Schooling, data = all_data)
summary(model1)

par(mfrow = c(2, 2))
plot(model1)
```
```{r, echo=FALSE, message=FALSE, warning=FALSE}
mod.resid <- resid(model1)
mod.fitted <- fitted(model1)
mod.sresid <- rstandard(model1)

## Response vs. Fitted plot
plot(mod.fitted,all_data$bc_GDP,xlab="Fitted",ylab="GDP",
     main="Fitted vs Response")
abline(a=0,b=1,col="red",lwd=2)

## Residuals vs Fitted plot
plot(mod.fitted,mod.resid,xlab="Fitted",ylab="Residuals",
     main="Fitted vs. Residuals")
abline(h=0,col="blue",lwd=2)

## QQ plot
qqnorm(mod.sresid); qqline(mod.sresid)


## Load car package
library(car)
vif(model1)

## Leverage points
mod.hii <- hatvalues(model1)
plot(mod.hii,type="h",ylab='hii',main="Leverage values")
## Define the cutoff for leverage points
cutoff.leveragepoints <- 2*(6+1)/nrow(all_data)
cutoff.leveragepoints.bis <- 3*(6+1)/nrow(all_data)
abline(h=cutoff.leveragepoints,col="red")
abline(h=cutoff.leveragepoints.bis,col="blue")
abline(h=0.5,col="green")
mod.hii
which(mod.hii>cutoff.leveragepoints)


## Outliers
plot(mod.sresid,type="h")
abline(h=4,col="red")
abline(h=-4,col="red")
which(abs(mod.sresid)>4)

## Influential points

## 1. Cook's distance
mod.dii <- cooks.distance(model1)
plot(mod.dii,type="h",ylab="Dii")
cutoff_dii <- qf(0.5,df1=7,df2=(nrow(all_data)-6-1))
abline(h=cutoff_dii,col="red")
abline(h=1,col="blue")
abline(h=4/nrow(all_data),col="green")
which(mod.dii>(4/nrow(all_data)))
## Based on the cutoff 4/n

## 2. Difference in fitted values
mod.dffits <- dffits(model1)
plot(mod.dffits,type="h",ylab="DFFITS")
cutoff.dffits <- 2*sqrt(7/nrow(all_data))
abline(h=cutoff.dffits,col="red")
abline(h=-cutoff.dffits,col="red")
which(abs(mod.dffits)>cutoff.dffits)


```

#### Model 2 log-transformed expenditure ###
```{r, echo=FALSE, message=FALSE, warning=FALSE}
all_data <- read.csv("Life_Expectancy_Data.csv")
all_data <- na.omit(all_data)

all_data$bc_GDP <- (all_data$GDP^0.3030303 - 1)/0.3030303
all_data$log_expenditure <- log(all_data$percentage.expenditure)

all_data <- all_data[is.finite(all_data$bc_GDP) & is.finite(all_data$log_expenditure), ]

response <- all_data$bc_GDP
x0 <- all_data$log_expenditure
x1 <- all_data$Polio
x2 <- all_data$Population
x3 <- all_data$Income.composition.of.resources
x4 <- all_data$Schooling

all_data$Status <- as.factor(all_data$Status)

model2 <- lm(response ~ Status + x0 + x1 + x2 + x3 + x4, data = all_data)
summary(model2)

vif(model2)

par(mfrow = c(2, 2))
plot(model2)
```







